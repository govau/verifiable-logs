<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

        <style type="text/css">
        </style>

        <script type="text/javascript">
            function binaryArrayToString(d) {
                var rv = "";
                for (var j = 0; j < d.length; j++) {
                    rv += String.fromCharCode(d[j]);
                }
                return rv;
            }

            function restCall(path, data, success, failure) {
                var req = new XMLHttpRequest();
                req.onload = function (evt) {
                    switch (req.status) {
                    case 200:
                        var obj = JSON.parse(binaryArrayToString(new Uint8Array(req.response)));
                        success(obj, req);
                        break;
                    case 400:
                        failure("bad request");
                        break;
                    case 403:
                        failure("unauthorized");
                        break;
                    case 404:
                        failure("not found");
                        break;
                    default:
                        failure("internal error");
                    }
                };
                req.onerror = function (evt) {
                    failure("network error");
                };
                req.open("GET", path, true);
                req.responseType = "arraybuffer";
                req.send(data);
            }

            $(function () {
                $("#get_sth").click(function () {
                    restCall("ct/v1/get-sth?tree_size=" + Number($("#get_sth_tree_size").val()), null, function (result) {
                        console.log(result);
                        var s = "";
                        s += "tree size: " + result.tree_size + "\n";
                        s += "root hash: " + result.sha256_root_hash + "\n";
                        $("#get_sth_result").text(s);
                    }, function (reason) {
                        $("#get_sth_result").text("error: " + reason);
                    });
                    return false;
                });
            })
        </script>
    </head>
    <body>
        <h1>Verifiable Log Viewer</h1>
        <p>See below for actions you can perform on this verifiable log. Note that all of these actions are read-only, feel free to click around without fear of breaking anything.</p>
        <h2>Get Signed Tree Head</h2>
        <p>This operation shows the signed tree head for the log.</p>
        <p>[ <a href="#" id="get_sth">Fetch Signed Tree Head</a> ] Tree size (leave blank for latest): <input type="text" id="get_sth_tree_size" /></p>
        <p>Result:</p>
        <pre id="get_sth_result"></pre>
    </body>
</html>